# Подготовка

По заданию среда, в которой мы будем работать - Python 3.11. Значит, необходимо настроить эту среду на тех ПК, на которых мы будем работать, желательно ещё и сделать эту среду переносимой чтобы не привязываться к одному рабочему месту.

Задача: 
- Запустить среду python-3.11 на любом компе без сложных танцев с бубном.
- По возможности разоворачивать эту среду быстро и на разных ПК.
Методы: 
- Установка brew. Пакетный менеджер brew работает только на unix-системах, стало быть, любой ПК с windows придётся настраивать отдельно.
- Использование виртуальной машины. Виртуализация доступна на любой платформе, виртуальная конфигурация переносима.

Попробовав настроить brew на школьном маке я пришёл к выводу, что работать через него крайне неудобно. Долгая установка, частые ошибки и необходимость постоянного запуска установочного скрипта на каждом новом маке с последующим ожиданием отталкивают.

А вот виртуальная машина с установленным python на текущем этапе кажется мне более предпочтительным вариантом. Именно его я выбрал для выполнения задач ветки питона.

### Шаг 1. Знакомство с Vagrant

Дабы создание виртуальной операционной системы не было сложным, я автоматизировал его при помощи vagrant. Vagrant - система конфигурирования среды виртуализации, позволяющая запускать виртуальные машины при помощи набора скриптов.

Сначала запустим центр приложений и установим vagrant:

![vagrant](media/vagrant/step_00.png)

Затем убедимся, что наш virtualbox сохраняет свои конфигурации в goinfre:

![vagrant](media/vagrant/step_02.png)

Иначе может не хватить памяти на школьном маке. На домашних машинах можно выбирать любой удобный раздел.

Специально под нашу задачу я подготовил конфигурацию vagrant на debian с python3.11. Скачаем её в goinfree:

``git clone https://github.com/codesshaman/vagrant_python_debian.git``

Далее нам необходимо скачать образ debian11 с [vagrantup](https://app.vagrantup.com/bento/boxes/debian-11.5 "vagrantup"):

Скачиваем из строки с virtualbox и сохраняем в папку склонированного репозитория под именем debian.

Теперь редактируем Vagrantfile, изменив в нём переменные с выделенным процессором, памятью и ссылкой на гит-репозиторий. На школьных маках выделенные ресурсы можно не менять, а вот на более слабых ПК можно уменьшить количество выделенных ресурсов во избежании подвисаний. 

Далее проверим версию virtualbox на школьном маке. На момент написания гайда это версия 6.1.34, но всё может измениться. Идём на сайт [исходников virtualbox](http://download.virtualbox.org/virtualbox/) (в соответствии с синструкцией в комментариях), заходим в директорию своей версии virtualbox, клацаем правой кнопкой на файле гостевых дополнений и копируем адрес ссылки:

![vagrant](media/vagrant/step_01.png)

Заносим скопированную ссылку в переменную GUEST_ADDITIONS нашего Vagrantfile. Так же скопируем ссылку на наш репозиторий (можно пропустить и добавить репозиторий уже после установки системы), в моём случае это репозиторий с данным гайдом.

Получилось примерно следующее:

![vagrant](media/vagrant/step_05.png)

Проверим так же, что у нас есть сгенерированный ключ id_rsa.pub в ~/.ssh, так как конфигурация vagrant будет использовать его для входа по ssh без пароля.

Далее надо выполнить последовательно лишь две команды, находясь в корне репозитория vagrant_python_debian:

``make build`` и ``make``.

Подробнее процесс установки описан в Readme репозитория.

Процесс установки может занять достаточно долгое время, можно погулять, сыграть пару партий в теннис или попить чаю. На школьном маке у меня этот процесс занял 13 минут.

### Шаг 2. Подключение к конфигурации

Чтобы зайти на созданную виртуальную машину достаточно команды ``make connect`` из каталога репозитория или же подключения по ssh из любого терминала хоста:

``ssh vagrant@192.168.58.98``

Если мы указали в Vagrantfile ссылку на репозиторий нашего проекта, мы должны увидеть папку с именем репозитория в корневой директории.

Но подключаться по ssh из терминала неудобно, потому используем плагин remote_SSH чтобы работать непосредственно из VsCode.

Находим в поиске по плагинам "Remote - SSH" и устанавливаем его.

Создаём новое соединение:

![vagrant](media/vagrant/step_03.png)

Вводим следующую команду для подключения:

``ssh vagrant@192.168.58.98``

И добавляем его в конфиг ssh. Теперь, после того как мы обновим список соединений, мы увидим наш локальный сервер и сможем с ним соединиться.

![vagrant](media/vagrant/step_04.png)

Откроем новое соединение в новом окне, а затем выберем в качестве пути к директории наш путь к скачанному репозиторию или же непосредственно к папке src. Таким образом мы можем работать с данным репозиторием, используя VsCode хостовой машины!

### Шаг 3. Добавляем ключи в gitlab

Чтобы спокойно работать с gitlab с виртуальной машины необходимо сгенерировать внутри неё ssh-ключ и добавить в школьный gitlab (или же в личный github если проект делается там).

Для этого создаём удалённое соединение и на виртуальной машине переходим в папку ssh:

``cd ~/.ssh``

Здесь нам необходимо сгенерировать новый ключ:

``ssh-keygen -t rsa``

Несколько раз нажимаем Enter и в результате получаем два файла - публичный и приватный ключи:

```
vagrant@debian-python:~/.ssh$ ls -la
total 20
drwx------ 2 vagrant root    4096 Dec 18 13:40 .
drwxr-xr-x 5 vagrant vagrant 4096 Dec 18 13:26 ..
-rw------- 1 vagrant vagrant  957 Dec 18 12:53 authorized_keys
-rw------- 1 vagrant vagrant 2610 Dec 18 13:40 id_rsa
-rw-r--r-- 1 vagrant vagrant  575 Dec 18 13:40 id_rsa.pub
```

Нам нужно вывести публичный ключ и скопировать его содержимое:

``cat id_rsa.pub``

Затем добавить этот ключ в свой гит.

### Шаг 4. Открываем GUI конфигурации

Теперь в самом virtualbox открываем окно виртуальной машины. Поменяем разрешение в настройках (мне достаточно 200%):

![vagrant](media/vagrant/step_06.png)

Переходим в окно виртуалки, логинимся используя в качестве логина и пароля слово "vagrant".

Для запуска GUI выполняем команду:

``sudo startx``

Сначала появится чёрный экран, но это означает, что всё сработало. Поклацав правой кнопкой мыши в выпадающем меню мы легко разберёмся во всех тонкостях легковесного графического окружения openbox.

Если хочется работать прямо в этом виртуальном окружении, можно в терминале kitty установить ещё и браузер:

``apt install firefox-esr``

Я же использую браузер хостовой машины и работаю в хостовой IDE, потому мне лишь изредка будет нужен QtDesigner для того, чтобы смотреть названия объектов QT. Ну и сам python 3.11, который мы успено установили.

Так же написанное приложение нужно будет запускать, и среда openbox для этого подойдёт на время разработки.

### Шаг 5. Делаем конфигурацию переносимой

Виртуальную машину с нужной нам версией python так же легко переносить с одного хоста на другой.

Подробную инструкцию о том, как это делать, я составил для проекта inception и с ней можно ознакомиться [здесь](https://github.com/codesshaman/inception/blob/main/03_CLOUD_STORAGE.md).

Теперь у нас есть почти всё, что нужно для разработки. По мере необходимости мы добавим в виртуальную машину так же и графическое окружение. А пока начнём разработку с нашего ядра!